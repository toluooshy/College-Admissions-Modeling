---
title: "Predicting Franklin W. Olin College of Engineering's Yield Rate over time"
output: html_notebook
---

## Introduction

In the competitive world of college admissions, many prospective students wanting to apply to the higher echelon of universities often think about many factors such as their standardized test scores, their GPAs, their recommendation letters and their essays. And while all these factors are important for a student's chances of entering their dream university, most of the times, it is also the goal of the university to make sure they accept the right students to build a well-balanced class.

A college's yield rate is the percentage of students after having been offered admission calculated by dividing the number of students who choose to enroll at a school in a given year, which is often based on their decision to pay a deposit, by the total number of offers of acceptance sent.

While a higher yield rate does indicate a sign of a more selective college, the statistic is more important for a college to decide how many students to accept in their entering freshman class. If a college miscalculates the percentage of students who accept an offer of admission, they run the risk of either underclassing or overclassing their incoming freshman class. If the university underclasses, they lose the opportunity on tuition money the university could have gained and used to improve their facilities. A university overclassing, on the other hand, may lead to losing out on potential tuition money and a poorer quality of life for their students: an issue that universities like [Northeastern](https://huntnewsnu.com/68925/editorial/op-ed-northeastern-needs-to-fix-the-current-housing-crisis/) and [schools in the University of California](https://www.latimes.com/california/story/2022-09-26/college-housing-shortage-pushes-students-into-crisis-as-most-uc-classes-start-up) system faces now.

And with those risks, every college, since it is essential to keep students happy while maximizing profit, should examine themselves, in our analysis of the Olin College of Engineering, and level up their expectations for their yield rates before going into the next recruitment season.

## Setup

### Load Data

Loading in admissions data (pre-formatted in Excel)

Variables Include - Percent Admitted (Total, Men, Women) - Percent Admitted Yield (Total, Men, Women) - Number of Applicants (Total, Men, Women) - Number of Admitted (Total, Men, Women) - Number Enrolled (Total, Men, Women)

### Convert Data into Dataframe

```{r}
admissions <- read.csv("yield-rate-data.csv")
admissions
```

### Format Total Dataframe into TimeSeries

```{r}
admissions_ts <- ts(admissions[,-1], start=c(2002), end=c(2021),frequency=1)
admissions_ts
```

### Select Admissions Yield Total and verify if output is timeseries

```{r}
admissions_yield_ts <- ts(admissions_ts[,1], start=c(2002), end=c(2021),frequency=1)
admissions_yield_ts
print(admissions_yield_ts)
```

## General Analysis

### Get Summary Statistics of Admissions Timeseries

```{r}
summary(admissions_yield_ts)
```

### Analyze General Trend with a Linear Regression Line

```{r}

ts.plot(admissions_yield_ts, xlab="Year", ylab="Yield Percentage", main="Olin College Yield Percentage Over Time, 2002-2021", ylim=c(50,90), col = 'black', type='o') 
abline(reg=lm(admissions_yield_ts~time(admissions_yield_ts)), col='red')
legend("topright",
       legend = c("Total Yield Rate", "Fitted Line"),
       col = c('black', 'red'),
       pch = 16)
 mod1<-lm(admissions_yield_ts~time(admissions_yield_ts))
 diffs<-diff(admissions_yield_ts)
```

```{r}
ts.plot(diffs, xlab="Year", ylab="First Difference Yield Percentage", main="First Difference of Olin College Yield Percentage Over Time, 2002-2021", col = 'black', type='o') 
```

## Auto-Correlation

To determine what type of series we have, whether it is a white noise, random walk, auto regressive or moving average.

```{r}
acf(admissions_yield_ts, main="Autocorrelation of Total Yield Percentage")
acf(mod1$residuals, main="Autocorrelation of Detrended Total Yield Percentage")
acf(diffs, main="Autocorrelation of First Difference Total Yield Percentage")
```

## ARIMA Modelling

To model past admissions data in order to predict future yield rates, we used the statistical model known as the ARIMA model, which stands for Auto Regressive Integrated Moving Average. This model is based on the idea that the information in the past values of a time series data set alone can be used to predict future values and is the integration of two simpler models commonly used for analyzing and forecasting time series data.

This type of model is commonly used to model time series data, which is a sequence of data with values recorded over regular time intervals. This works great in our case because we're looking at admissions yield rates at the regular time interval of one academic year.

Another thing to note about ARIMA modelling is that it is used to model data that is stationary. Stationarity refers to the characteristic of observations that don't depend on time. For example, a dataset where the stationarity condition doesn't hold is seasonal rainfall since different times of the year will yield different values. In other words, a random variable that is a time series is stationary if its statistical properties (such as mean and variance) are all constant over time.

## AutoRegressive (AR) Modelling

This is a regrission model built on top of the concept of autocorrelation, where the dependent variable depends on the past values of itself. Autocorrelation relates the same set of observations across different timing. As shown in the equation below, in an AR model, observations are computed from prior terms. This equation takes in a parameter p which is the lag order. This is the number of prior time steps to include in the regression model.
![](https://lh4.googleusercontent.com/C9dxMuYkPOjvubqZlwyFA9ekZUzYPoUrXduJ5o5FATyiDaytUXy-0VYKO9HyeutVzKdEP8sTY_zRnTIYL5n2ra1kr1z-EmEvQ90y3KlqBurP8Ssnw8P37qN7x1fVdUa1w_TuX-kLd4a9_bTJ_ELfX6dT-rpXL2PnrrP-u3BKCd7dJ30R2IUj-6II9J2DntA8){width="447"}
Modelling our yield rate data using AR gives us the following fitted line:

```{r}
AR <- arima(admissions_yield_ts, order = c(1,0,0))
print(AR)
```
 
```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main="Fitted Auto Regressive Admission Yield Model Over Time",col='black',ylim=c(50,100),type='o')
AR_fit <- admissions_yield_ts - residuals(AR)
points(AR_fit, type = "l", col = 'red', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Line"),
       col = c('black', 'red'),
       pch = 16)
```

Next, we used predict() to make a 1-step forecast and to make 1-step through 10-step forecasts:

```{r}
predict_AR <- predict(AR)
predict(AR, n.ahead = 10)
```

Plotting the series along with the forecast prediction and 95% prediction intervals:

```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main = "AR Predicted Yield Over One Year", col = 'black', xlim = c(2000, 2022), ylim = c(40, 100),type='o')
AR_forecast <- predict(AR, n.ahead = 10)$pred
AR_forecast_se <- predict(AR, n.ahead = 10)$se
points(AR_forecast, type = "o", col = 'red')
points(AR_forecast - 2*AR_forecast_se, type = "l", col = 'blue', lty = 2)
points(AR_forecast + 2*AR_forecast_se, type = "l", col = 'blue', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'red', 'blue'),
       pch = 16)
```

## Moving Average (MA) Modelling

Fitting the MA model to admissions_total_yield

```{r}
MA <- arima(admissions_yield_ts, order = c(0,0,1))
print(MA)
```

Plotting the series along with the MA fitted values

```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main="Fitted Moving Average Admission Yield Model Over Time",col='black',ylim=c(50,100),type='o')
MA_fit <- admissions_yield_ts - residuals(MA)
points(MA_fit, type = "l", col = 'red', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Line"),
       col = c('black', 'red'),
       pch = 16)
```

Making and obtaining a 1-step forecast based on MA as well as a 10-step forecast

```{r}
predict_MA <- predict(MA)
predict_MA$pred[1]

predict(MA,n.ahead=10)
```

Plotting the Total Admissions Yield Percentage data with the forecast and 95% prediction intervals

```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main = "MA Predicted Yield Model Over One Year", col = 'black', xlim = c(2002, 2032), ylim = c(40, 100),type='o')
MA_forecasts <- predict(MA, n.ahead = 10)$pred
MA_forecast_se <- predict(MA, n.ahead = 10)$se
points(MA_forecasts, type = "o", col = 'red')
points(MA_forecasts - 2*MA_forecast_se, type = "l", col = 'blue', lty = 2)
points(MA_forecasts + 2*MA_forecast_se, type = "l", col = 'blue', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'red', 'blue'),
       pch = 16)
```

## Analyzing Models

Find correlation between AR_fit and MA_fit

```{r}
cor(AR_fit, MA_fit)
```

Find AIC (Akaike Information Criterion) of AR and MA Models

```{r}
AIC(AR)
```

```{r}
AIC(MA)
```

Find BIC (Bayesian Information Criterion) of AR and MA Models

```{r}
BIC(AR)
```

```{r}
BIC(MA)
```

# Viewing Yield Rate Through The Men/Women Split

## Formating Data

### Selecting data to be the tield total of men and women as timeseries

```{r}
admissions_men_ts <- ts(admissions_ts[,5], start=c(2002), end=c(2021),frequency=1)
admissions_women_ts <- ts(admissions_ts[,6],start=c(2002), end=c(2021),frequency=1)
```

## Analysis of Gendered Data

### Men

```{r}
summary(admissions_men_ts)
```

### Women

```{r}
summary(admissions_women_ts)
```

Overall, the yield rate for women is lower on average than the yield rate for men based on the summaries of each.

## Analyze General Linear Regression Lines

```{r}
plot(admissions_women_ts, xlab="Year", ylab="Yield Percentage", main="Olin College Yield Percentage Over Time, 2002-2021", ylim=c(20,100), col = 'black') 
abline(reg=lm(admissions_women_ts~time(admissions_women_ts)), col='red')
lines(admissions_men_ts, col = 'blue')
abline(reg=lm(admissions_men_ts~time(admissions_women_ts)), col='green')
legend("topleft",
       legend = c("Women", "Men", "Women's Fitted Line", "Men's Fitted Line"),
       col = c('black', 'blue', 'red', 'green'),
       pch = 16)
```

## Analyzing With Auto-Correlation

### Men

## ARIMA Modeling

### Creating AR Models

```{r}
ARmen <- arima(admissions_men_ts, order = c(1,0,0))
ARwomen <- arima(admissions_women_ts, order = c(1,0,0))

plot(admissions_women_ts, ylab = "Yield Percentage", main="Fitted Auto Regressive Admission Yield Model Over Time",col='black',ylim=c(0,100))

lines(admissions_men_ts, col = 'blue')

AR_fit_women <- admissions_women_ts - residuals(ARwomen)
points(AR_fit_women, type = "l", col = 'red', lty = 2)

AR_fit_men <- admissions_men_ts - residuals(ARmen)
points(AR_fit_men, type = "l", col = 'green', lty = 2)

legend("bottomright",
       legend = c("Women's Yield Rate", "Men's Yield Rate", "Women's Fitted Line", "Men's Fitted Line"),
       col = c('black','blue','red','green'),
       pch = 16)
```

Predicting the 1-step forecast throuhg making 1-step through 10-step forecasts

```{r}
predict_ARmen <- predict(ARmen)
predict_ARwomen <- predict(ARwomen)
predict(ARmen, n.ahead = 10)
predict(ARwomen, n.ahead = 10)
```

Plotting the series plus the forecast and 95% prediction intervals

```{r}
ts.plot(admissions_women_ts, ylab = "Yield Percentage", main = "AR Predicted Women's Yield Over Ten Years", col = 'black', xlim = c(2002, 2031), ylim = c(0, 100),type='o')

AR_forecastwomen <- predict(ARwomen, n.ahead = 10)$pred
AR_forecastwomen_se <- predict(ARwomen, n.ahead = 10)$se
points(AR_forecastwomen, type = "o", col = 'red')
points(AR_forecastwomen - 2*AR_forecastwomen_se, type = "l", col = 'blue', lty = 2)
points(AR_forecastwomen + 2*AR_forecastwomen_se, type = "l", col = 'blue', lty = 2)

legend("topleft",
       legend = c("Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'red', 'blue'),
       pch = 16)
```

```{r}
ts.plot(admissions_men_ts, ylab = "Yield Percentage", main = "AR Predicted Men's Yield Over Ten Years", col = 'black', xlim = c(2002, 2031), ylim = c(20, 100),type='o')

AR_forecastmen <- predict(ARmen, n.ahead = 10)$pred
AR_forecastmen_se <- predict(ARmen, n.ahead = 10)$se
points(AR_forecastmen, type = "o", col = 'red')
points(AR_forecastmen - 2*AR_forecastmen_se, type = "l", col = 'blue', lty = 2)
points(AR_forecastmen + 2*AR_forecastmen_se, type = "l", col = 'blue', lty = 2)

legend("topleft",
       legend = c("Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'red', 'blue'),
       pch = 16)

```

## Creating MA Models

```{r}
MAmen <- arima(admissions_men_ts, order = c(0,0,1))
MAwomen <- arima(admissions_women_ts, order = c(0,0,1))
```

Plotting the series along with the MA fitted values

```{r}
plot(admissions_women_ts, ylab = "Yield Percentage", main="Fitted Moving Average Admission Yield Model Over Time",col='black',ylim=c(20,100))

MA_fitwomen <- admissions_women_ts - residuals(MAwomen)
points(MA_fitwomen, type = "l", col = 'red', lty = 2)

lines(admissions_men_ts, col = 'blue')
MA_fitmen <- admissions_men_ts - residuals(MAmen)
points(MA_fitmen, type = "l", col = 'green', lty = 2)

legend("topleft",
       legend = c("Women's Yield Rate", "Men's Yield Rate", "Women's Fitted Line", "Men's Fitted Line"),
       col = c('black','blue', 'red', 'green'),
       pch = 16)
```

Making and obtaining a 1-step forecast based on MA as well as a 10-step forecast

```{r}
predict_MAmen <- predict(MAmen)
predict_MAmen$pred[1]
predict(MAmen,n.ahead=10)

predict_MAwomen <- predict(MAwomen)
predict_MAwomen$pred[1]
predict(MAwomen,n.ahead=10)

```

Plotting the Total Admissions Yield Percentage data with the forecast and 95% prediction intervals

```{r}
ts.plot(admissions_women_ts, ylab = "Yield Percentage", main = "MA Predicted Women's Yield Model Over Ten Years", col = 'black', xlim = c(2002, 2031), ylim = c(20, 100),type='o')
MA_forecastswomen <- predict(MAwomen, n.ahead = 10)$pred
MA_forecastwomen_se <- predict(MAwomen, n.ahead = 10)$se
points(MA_forecastswomen, type = "o", col = 'red')
points(MA_forecastswomen - 2*MA_forecastwomen_se, type = "l", col = 'blue', lty = 2)
points(MA_forecastswomen + 2*MA_forecastwomen_se, type = "l", col = 'blue', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'red', 'blue'),
       pch = 16)
```

```{r}
ts.plot(admissions_men_ts, ylab = "Yield Percentage", main = "MA Predicted Men's Yield Model Over Ten Years", col = 'black', xlim = c(2002, 2031), ylim = c(20, 100),type='o')
MA_forecastsmen <- predict(MAmen, n.ahead = 10)$pred
MA_forecastmen_se <- predict(MAmen, n.ahead = 10)$se
points(MA_forecastsmen, type = "o", col = 'red')
points(MA_forecastsmen - 2*MA_forecastmen_se, type = "l", col = 'blue', lty = 2)
points(MA_forecastsmen + 2*MA_forecastmen_se, type = "l", col = 'blue', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'red', 'blue'),
       pch = 16)
```
## Cross Analyzing Models

<< TODO

## Conclusion

And how should interested applicants use this calculation to their advantage? - Be interested in Olin - Learn more about it

Many students make the choice, a good choice of attending Olin! \<- insert propaganda

## Resources

-   [https://en.wikipedia.org/wiki/Yield\_(college_admissions)\#](https://en.wikipedia.org/wiki/Yield_(college_admissions)#){.uri}:\~:text=It%20is%20calculated%20by%20dividing,particular%20school%20of%20higher%20education.
-   <https://www.rdocumentation.org/packages/tseries/versions/0.7-5/topics/arma>
-   <https://rpubs.com/JSHAH/481706>
-   <https://otexts.com/fpp2/arima-r.html>
-   <https://www.statology.org/aic-in-r/>
-   <https://www.statology.org/bic-in-r/>
-   <https://bookdown.org/JakeEsprabens/431-Time-Series/>
-   <https://mybiostats.files.wordpress.com/2015/03/time-series-analysis-and-its-applications-with-examples-in-r.pdf>
