---
title: "Franklin W. Olin College's Yield Rate over Time"
output: html_notebook
---

## R Notebook Basics

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

## Introduction

Analyzing Olin College's Yield Rate over time.

Yield Rate is how many students accepted by college / how many students get accepted.

## Setup

### Load Data

Loading in admissions data (pre-formatted in Excel)

Variables Include
- Percent Admitted (Total, Men, Women)
- Percent Admitted Yield (Total, Men, Women)
- Number of Applicants (Total, Men, Women)
- Number of Admitted (Total, Men, Women)
- Number Enrolled (Total, Men, Women)

### Convert Data into Dataframe

```{r}
admissions <- read.csv("yield-rate-data.csv")
admissions
```

### Format Total Dataframe into TimeSeries

```{r}
admissions_ts <- ts(admissions[,-1], start=c(2006), end=c(2021),frequency=1)
admissions_ts
```

### Select Admissions Yield Total and verify if output is timeseries

```{r}
admissions_yield_ts <- ts(admissions_ts[,4], start=c(2006), end=c(2021),frequency=1)
admissions_yield_ts
print(admissions_yield_ts)
```

## General Analysis

### Get Summary Statistics of Admissions Timeseries

```{r}
summary(admissions_yield_ts)
```

### Analyze General Trend with a Linear Regression Line

```{r}

ts.plot(admissions_yield_ts, xlab="Year", ylab="Yield Percentage", main="Olin College Yield Percentage Over Time, 2006-2021", ylim=c(50,80), col = 'black') 
abline(reg=lm(admissions_yield_ts~time(admissions_yield_ts)), col='red')
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Line"),
       col = c('black', 'red'),
       pch = 16)

```

## Auto-Correlation

To determine what type of series we have, whether it is a white noise, random walk, auto regressive or moving average.

```{r}
acf(admissions_yield_ts, main="Autocorrelation of Total Yield Percentage")
```

## ARIMA Modelling

Create AutoRegressive (AR) Model

```{r}
AR <- arima(admissions_yield_ts, order = c(1,0,0))
print(AR)
```

 
```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main="Fitted Auto Regressive Admission Yield Model Over Time",col='black',ylim=c(50,80))
AR_fit <- admissions_yield_ts - residuals(AR)
points(AR_fit, type = "l", col = 'red', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Line"),
       col = c('black', 'red'),
       pch = 16)
```

Using predict() to make a 1-step forecast and to make 1-step through 10-step forecasts

```{r}
predict_AR <- predict(AR)

predict(AR, n.ahead = 10)
```

Plotting the series plus the forecast and 95% prediction intervals

```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main = "AR Predicted Yield Over One Year", col = 'black', xlim = c(2006, 2022), ylim = c(50, 80))
AR_forecast <- predict(AR, n.ahead = 10)$pred
AR_forecast_se <- predict(AR, n.ahead = 10)$se
points(AR_forecast, type = "l", col = 'red')
points(AR_forecast - 2*AR_forecast_se, type = "l", col = 'blue', lty = 2)
points(AR_forecast + 2*AR_forecast_se, type = "l", col = 'blue', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'blue', 'red'),
       pch = 16)
```

Fitting the MA model to admissions_total_yield

```{r}
MA <- arima(admissions_yield_ts, order = c(0,0,1))
print(MA)
```

Plotting the series along with the MA fitted values

```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main="Fitted Moving Average Admission Yield Model Over Time",col='black',ylim=c(50,80))
MA_fit <- admissions_yield_ts - residuals(MA)
points(MA_fit, type = "l", col = 'red', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Line"),
       col = c('black', 'red'),
       pch = 16)
```

Making and obtaining a 1-step forecast based on MA as well as a 10-step forecast

```{r}
predict_MA <- predict(MA)
predict_MA$pred[1]

predict(MA,n.ahead=10)
```

Plotting the Total Admissions Yield Percentage data with the forecast and 95% prediction intervals

```{r}
ts.plot(admissions_yield_ts, ylab = "Yield Percentage", main = "MA Predicted Yield Model Over One Year", col = 'black', xlim = c(2006, 2022), ylim = c(50, 80))
MA_forecasts <- predict(MA, n.ahead = 10)$pred
MA_forecast_se <- predict(MA, n.ahead = 10)$se
points(MA_forecasts, type = "l", col = 'red')
points(MA_forecasts - 2*MA_forecast_se, type = "l", col = 'blue', lty = 2)
points(MA_forecasts + 2*MA_forecast_se, type = "l", col = 'blue', lty = 2)
legend("topleft",
       legend = c("Total Yield Rate", "Fitted Prediction", "95% Confidence Interval"),
       col = c('black', 'blue', 'red'),
       pch = 16)
```

## Analyzing Models

Find correlation between AR_fit and MA_fit

```{r}
cor(AR_fit, MA_fit)
```

Find AIC (Akaike Information Criterion) of AR and MA Models

```{r}
AIC(AR)
```

```{r}
AIC(MA)
```

Find BIC (Bayesian Information Criterion) of AR and MA Models

```{r}
BIC(AR)
```

```{r}
BIC(MA)
```


## Resources

- https://www.rdocumentation.org/packages/tseries/versions/0.7-5/topics/arma
- https://rpubs.com/JSHAH/481706
- https://otexts.com/fpp2/arima-r.html
- https://www.statology.org/aic-in-r/
- https://www.statology.org/bic-in-r/
